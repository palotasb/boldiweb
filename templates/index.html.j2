<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>{{folder.title}}
        {% if folder != album.target_root %}
            ‚Äì {{album.title}}
        {% endif %}
    </title>
    <link rel="stylesheet" href="{{ (album.target_static / 'style.css') | relative_to(folder.path) }}" />
    <script type="text/javascript" src="{{ (album.target_static / 'script.js') | relative_to(folder.path) }}"></script>
</head>
<body>
    <header>
        <h1>{{folder.title}}</h1>
        <nav>
        {% for parent in folder.parents + [folder] %}
            <a href="{{ parent.path | relative_to(folder.path) }}/index.html">{{parent.title}}</a>
            {{ "‚Üí" if not loop.last else "" }}
        {% endfor %}
        </nav>
    </header>

    <main id="main">
        {% if folder.subfolders | length %}
        <section id="subfolders" class="flex-masonry">
        {% endif %}
        {% set TARGET_SIZE = 150 %}
        {% for subfolder in folder.subfolders.values() %}
            %% set image = subfolder.cover_image
            %% set width = image.width
            %% set height = image.height
            %% set aspect = width / height
            <article
                class="flex-masonry-outer"
                style="
                    min-height: {{TARGET_SIZE}}px;
                    max-height: {{TARGET_SIZE*1.375}}px;
                    aspect-ratio: {{aspect}};
                    flex-grow: {{aspect}};
                ">
                <div
                    class="flex-masonry-inner"
                    style="aspect-ratio: {{aspect}}; max-height: {{TARGET_SIZE*1.375}}px;"
                    >
                    <a class="thumbnail-container" href="{{subfolder.path | relative_to(folder.path)}}/index.html">
                        <img
                            class="thumbnail"
                            style="aspect-ratio: {{aspect}};"
                            alt="{{ subfolder.title }}"
                            src="{{ image.path_800w | relative_to(folder.path) }}"
                        />
                    </a>
                    <h2><a href="{{subfolder.path | relative_to(folder.path)}}/index.html">{{subfolder.title}}</a></h2>                
                </div>
            </article>
        {% endfor %}
        {% if folder.subfolders | length %}
        </section>
        {% endif %}

        <!--
        {% if folder.images | length %}
        <section id="thumbnails">
        {% endif %}

        {% if folder.images | length %}
        </section>
        {% endif %}
        -->
        
        {% if folder.images | length %}
        <section id="images">
        {% endif %}
        {% for name, image in folder.images.items() %}
            <article class="image" id="{{ image.path.stem }}">
                <picture style="display: block;">
                    <img class="image"
                        src="{{image.path | relative_to(folder.path)}}"
                        alt="{{image.exif.IPTC.Artist}}" />
                </picture>
                <div class="description">
                <h2><a href="#{{ image.path.stem }}">{{image.title}}
                    {% if image.title != image.source.path.stem %}
                    <small>[{{image.path.stem}}]</small>
                    {% endif %}
                </a></h2>
                <p class="image-description">
                    {{image.description or undefined}}
                </p>
                <p class="exposure-info">
                    f = {{image.focal_length | human_round or "?"}}mm
                    ({{image.focal_length_35mm | human_round or "?"}}mm <small>FOV at 35mm equiv.</small>),
                    ùëì/{{image.aperture | human_round or "?"}},
                    {{image.shutter_speed | human_round or "?"}}s,
                    ISO {{image.iso | human_round or "?"}},
                    LV {{image.light_value | human_round or "?"}}
                </p>
                <p class="camera-info">
                    {{image.camera}} {{ "+" if image.camera and image.lens else "" }}
                    {{image.lens}}
                </p>
                <p>
                    <a href="#top" class="subtle">‚áß {{ folder.title }}</a> |
                    <a href="javascript:toggleFullscreen()" class="subtle"><span>üì∫ </span>Full screen</a>
                </p>
                </div>
            </article>
        {% endfor %}
        {% if folder.images | length %}
        </section>
        {% endif %}
    </main>
  
    <footer id="bottom">
        <nav>
        {% for parent in folder.parents + [folder] %}
            <a href="{{ parent.path | relative_to(folder.path) }}/index.html">{{parent.title}}</a>
            {{ "‚Üí" if not loop.last else "" }}
        {% endfor %}
        </nav>
        <p id="copyright">Copyright &copy;</p>
    </footer>
</body>
</html>
